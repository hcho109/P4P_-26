<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>EmotionalGUI Annotation WebPage</title>
        <!-- Add icon library -->
        <link 
        rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" 
        />
        <link href="css/annotationStyle.css" rel="stylesheet" type="text/css" />
        <link href="css/mediaPlayerStyle.css" rel="stylesheet" type="text/css" />
        <link href="css/navStyle.css" rel="stylesheet" type="text/css" />
        <link href="css/liveAudioStyle.css" rel="stylesheet" type="text/css" />
        
    </head>

    <body>
        
        <!-- Top navigation -->
        <header>   
        <div class="website_name">
            <img src="resources/University_of_Auckland_logo.png" width='60px' height='auto' alt = "UoA logo">
            <h3>EmotionGUI</h3>
        </div>
        <nav>
            <ul class="nav_links">
                <li><a href="home.html">Home</a></li>
                <li><a href="annotation.html">Annotation</a></li>
                <li><a href="visualise.html">Visualise</a></li>
                <li><a class="active" href="liveAudio.html">Live Audio</a></li>      
            </ul>
        </nav>
        <div class="dropdown">
            <button class="dropbtn">Help 
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <button onclick = "createPopupWin('#aboutEmotionGUI', 'EmotionGUI', 1000, 650);">EmotionGUI</button>
                <button onclick = "createPopupWin('about/aboutAnnotation.html', 'Annotation', 1000, 650);">Annotation</button>
                <button onclick = "createPopupWin('#aboutVisualise', 'Visualise', 1000, 650);">Visualise</button>
                <button onclick = "createPopupWin('#aboutLiveAudio', 'Live Audio', 1000, 650);">Live Audio</button>
            </div>
        </div> 
        </header>

        <div class="centered">
            <h2> Live Audio Recording </h2>
            <div class="container">
                <div class="record_control_container">
                    <div class="rec_buttons">
                        <button class="start_btn" id="startRecording">Start</button>
                        <button class="stop_btn" id="stopRecording">Stop</button><br>
                        <p id="isRecording">Click 'Start' button to record</p>
                    </div>
                </div>

                <div class="Btns_container">
                    <form class="save_buttons">
                        <input type="button" class= rec_save_btn id="saveRecording" value="Download Audio Recording">
                        <div class="audio-img">
                            <input type="button" class= img_save_btn id="saveSpectrogram" value="Save Spectrogram">
                            <input type="button" class= img_save_btn id="saveWaveform" value="Save Waveform">
                        </div>
                    </form>
                </div>
            </div>

            <div class="audioData_container">
                <audio id="audioElement" src="" controls="true"></audio>
                <p class="subtitle">Real-Time Spectrogram</p>
                <canvas class="canvas_audio" id="canvas_spectrogram"></canvas>
                <p class="subtitle">Audio Waveform</p>
                <canvas class="canvas_audio" id="canvas_waveform"></canvas>
            </div>
        </div>
    </body>

 
    <!-- Audio recording javascript -->
    <script src="liveAudio_js/rec_script.js"></script>

    <!-- Temporarily added spectrogram image -->
    <script>
        function drawImageScaled(img, ctx) {
            var canvas = ctx.canvas ;
            var hRatio = canvas.width  / img.width    ;
            var vRatio =  canvas.height / img.height  ;
            var ratio  = Math.max ( hRatio, vRatio );
            var centerShift_x = ( canvas.width - img.width*ratio ) / 2;
            var centerShift_y = ( canvas.height - img.height*ratio ) / 2;  
            ctx.clearRect(0,0,canvas.width, canvas.height);
            ctx.drawImage(img, 0,0, img.width, img.height,
                                centerShift_x,centerShift_y,img.width*ratio, img.height*ratio);  
        }
        
        var canvas=document.getElementById("canvas_spectrogram");
        var ctx=canvas.getContext("2d");
        var img = new Image();
        img.src = "resources/spec.png";
        img.onload = function(){
            drawImageScaled(img,ctx)
        }
    </script>

</html>
