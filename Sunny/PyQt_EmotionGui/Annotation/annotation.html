<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EmotionalGUI Annotation WebPage</title>
    <!-- Add icon library -->
    <link 
      rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
      crossorigin="anonymous" referrerpolicy="no-referrer" 
    />
    <link href="annotationStyle.css" rel="stylesheet" type="text/css" />
    <link href="mediaPlayerStyle.css" rel="stylesheet" type="text/css" />
    <link href="navStyle.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
  </head>

  <body>
    
    <!-- Top navigation -->
    <header>   
      <div class="website_name">
          <img src="resources/University_of_Auckland_logo.png" alt = "UoA logo">
          <h3>EmotionGUI</h3>
      </div>
      <nav>
          <ul class="nav_links">
            <li><a href="home.html">Home</a></li>
            <li><a class="active" href="annotation.html">Annotation</a></li>
            <li><a href="visualise.html">Visualise</a></li>
            <li><a href="liveAudio.html">Live Audio</a></li>      
          </ul>
      </nav>
      <div class="dropdown">
          <button class="dropbtn">Help 
              <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
              <button onclick = "createPopupWin('#aboutEmotionGUI', 'EmotionGUI', 1000, 650);">EmotionGUI</button>
              <button onclick = "createPopupWin('about/aboutAnnotation.html', 'Annotation', 1000, 650);">Annotation</button>
              <button onclick = "createPopupWin('#aboutVisualise', 'Visualise', 1000, 650);">Visualise</button>
              <button onclick = "createPopupWin('#aboutLiveAudio', 'Live Audio', 1000, 650);">Live Audio</button>
          </div>
      </div> 
    </header>

    <!------------------ Left column ------------------------->
    <div class="split left">
      <div class="centered">
        <div class="subtitle">
          <h3>Video/Audio Multimedia</h3>
        </div>

        <!--Multimedia player tab links-->
        <div class="mediaPlayerTabs">
          <!---------------- Video player tab------------------>
          <input type="radio" id="tabVideoPlayer" name="mediaPlayerTabs" checked="checked">
          <label for="tabVideoPlayer">Video player</label>
          
          <!-- Video player tab content-->
          <div class="mediaPlayerTabcontent">
            <input class="open-file-btn" type="file" accept="audio*,video*" id="video-file-input" value="Open Video File">
              <video class="video" id="video" controls>
                Your browser does not support the video tag.
              </video><br>
              <p> * This video player does not support WMV files </p>
          </div>

          <!------------------ Audio player tab---------------------->
          <input type="radio" id="tabAudioPlayer" name="mediaPlayerTabs">
          <label for="tabAudioPlayer">Audio player</label>

          <!-- Audio player tab content-->
          <div class="mediaPlayerTabcontent">
            <input class="open-file-btn" id="fileinput" type="file" accept="audio*,video*"/>
            <canvas class="canvas_audio" id="canvas_audio"></canvas>
            <audio id="audio" src="" controls="true"></audio>
          </div>
        </div>
      </div>
    </div>

    <!------------------ Right Column ----------------->
    <div class="split right">
      <div class="centered">
        <div class="subtitle">
          <h3>Speech Emotion Annotation</h3>
        </div>
        <p>'Click' on the emotional model you want to use to annotate emotions in speech within the tabs below. Enjoy annotating emotions!</p>
      
        <!--Multimedia player tab links-->
        <div class="EMtabs">

          <!----------- discrete/categorical emotion model tab------------------->
          <input type="radio" id="tabCategory" name="EMtabs">
          <label for="tabCategory">Discrete/Categorical</label>
          
          <!-- categorical tab content-->
          <div class="EMtabContent">
            <button class="help_popup_btn" onclick="createPopupWin('about/aboutDisc.html',
            'About', 900, 600);">
              <i class="fas fa-question-circle fa-2xl" style="color: rgb(23, 60, 154);"></i>
            </button>
            <div class="content">
              <h4 style="margin-bottom: 0px; margin-top: 10px">Discrete/Categorical Emotion Model</h4>
              <hr style="height:1.5px;border-width:0;color:gray;background-color:gray;margin-top: none;;margin-left:0;width:260px">
              <p>
                <ul>
                  <li>In a discrete/categorical emotion model, emotions are typically represented 
                    as a fixed set of basic or primary emotions. 
                    Some commonly recognized basic emotions include happiness, sadness, anger, fear, surprise, and disgust.</li>
                  <li>After watching a video/ audio file, write a specific emotion that you believe best describes the overall emotion delivered in the video.  
                    <br><br>For detailed instructions, click on the '?' at the top rigt corner.</li>
                </ul>
              </p>
            </div>
            <div class="inputTextBox">
              <label for="emotionLabel">Emotion description (one word):</label>
              <input type="text" id="emotionLabel" name="emotionLabel" required size="15" >
              <input type="button" class= save_btn id="CSV_btn" value="Save as CSV"><br><br>
            </div>
          </div>

          <!------------- 1D emotion model tab------------------>
          <input type="radio" id="tab1D" name="EMtabs">
          <label for="tab1D">1-D</label>
          
          <!-- 1D tab content-->
          <div class="EMtabContent">
            <button class="help_popup_btn" onclick="createPopupWin('about/about1D.html',
            'About', 900, 600);">
              <i class="fas fa-question-circle fa-2xl" style="color: #ff1500;"></i>
            </button>
            <div class="content">
              <h4 style="margin-bottom: 0px; margin-top: 10px">One-dimensional (1-D) Emotion Model</h4>
              <hr style="height:1.5px;border-width:0;color:gray;background-color:gray;margin-top: none;;margin-left:0;width:275px">
              <p>
                <ul>
                  <li>As you watch a video or listen to an audio, use sliders below to annotate the emotions expressed in terms of valence, arousal and dominance.</li>
                  <li>Adjust each slider independently, focusing on one emotional dimension at a time.<br><br> For detailed instructions, click on the '?' at the top rigt corner.</li>
                </ul>
              </p>
            </div>
            
            <!--Valence slider bar-->
            <div class="range-slider"> 
              <form class="btns_1D">
                <input type="button" class="clear_btn" id="clear_btn" value="Clear values">
                <input type="button" class="save_btn" id="CSV_btn" value="Save as CSV">
              </form>
              <label for="valenceRange">Valence</label> 
              <input class="range-slider__range" type="range" value="0" min="-10" max="10" id="valenceRange" list="values">
              <span class="range-slider__value">0</span><br>
              <span>Unhappy</span>
              <span class="endLabel">Happy</span>
              <img class="samPics" src="resources/valenceSAM.png" alt="SAM valence images">
            </div>
            <hr>
            <!--Arousal slider bar-->
            <div class="range-slider">
              <form class="btns_1D">
                <input type="button" class="clear_btn" id="clear_btn" value="Clear values">
                <input type="button" class="save_btn" id="CSV_btn" value="Save as CSV">
              </form>
              <label for="arousalRange">Arousal</label> 
              <input class="range-slider__range" type="range" value="0" min="-10" max="10" id="arousalRange">
              <span class="range-slider__value">0</span><br>
              <span>Calm</span>
              <span class="endLabel">Excited</span>
              <img class="samPics" src="resources/arousalSAM.png" alt="SAM arousal images">
            </div>
            <hr>
            <!--Dominance slider bar-->
            <div class="range-slider">
              <form class="btns_1D">
                <input type="button" class="clear_btn" id="clear_btn" value="Clear values">
                <input type="button" class="save_btn" id="CSV_btn" value="Save as CSV">
              </form>
              <label for="dominanceRange">Dominance</label>
              <input class="range-slider__range" type="range" value="0" min="-10" max="10" id="dominanceRange">
              <span class="range-slider__value">0</span><br>
              <span>Independent</span>
              <span class="endLabel">Dependent</span>
              <img class="samPics" src="resources/dominanceSAM.png" alt="SAM dominance images">
            </div>
            <hr>

            <form class="btns_1D_all">
              <input type="button" class="clearAll_btn" id="clearAll_1Dbtn" value="Clear all current values">
              <input type="button" class="saveAll_btn" id="saveAll_1Dbtn" value="Save all current values as CSV">
            </form>
          </div>

          <!----------------- 2D emotion model tab------------------->
          <input type="radio" id="tab2D" name="EMtabs" checked="checked">
          <label for="tab2D">2-D</label>
          
          <!-- 2D tab content-->
          <div class="EMtabContent">
            <button class="help_popup_btn" onclick="createPopupWin('about/about2D.html',
            'About', 900, 600);">
              <i class="fas fa-question-circle fa-2xl" style="color: #04AA6D;"></i>
              <span class="helpPopupText" id="2dhelpPopup"></span>
            </button>
            <div class="content">
              <h4 style="margin-bottom: 0px; margin-top: 10px">Two-dimensional (2-D) Emotion Model</h4>
              <hr style="height:1.5px;border-width:0;color:gray;background-color:gray;margin-top: none;;margin-left:0;width:275px">
              <p>
                <ul>
                  <li>Please use the valence-arousal plot below to indicate your perception of emotions in the video or audio.</li>
                  <li> Move your cursor vertically for valence (positivity/negativity) and horizontally for arousal (intensity).<br><br> For detailed instructions, click on the '?' at the top rigt corner.</li>
                </ul>
              </p>
            </div>

            <!--------------- 2D V-A plot-------------->
            <div class="plotCanvas" id="VA-plot"></div>
            <py-config>
              packages = ["numpy", 
                          "matplotlib", 
                          "pandas",
                          "keras"
                          ]
              [[fetch]]
              from = "http://127.0.0.1:5500"
              files = ['annotationMethods.py']
              
            </py-config>

            <py-script output="VA-plot">
              from annotationMethods import createCircle
              import matplotlib.pyplot as plt

              fig = plt.figure()
              axes = fig.subplots()

              createCircle(axes)

              plt.title("V-A Plot")
              plt.xlabel("Valence")
              plt.ylabel("Arousal")

              display(fig, target="VA-plot")
            </py-script>

            <p id="plot-msg"></p>

            <form class="btns_2D">
              <input type="button" class="clear_btn" id="clear_btn" value="Clear">
              <input type="button" class="save_btn" id="CSV_btn" value="Save as CSV">
              <input type="button" class="reannotate_btn" id="reannotate_btn" value="Re-annotate">
            </form><br>
          </div>
      </div>
    </div>

    <!-- Audio waveform javascript -->
    <script src='https://codepen.io/bataimx/pen/JjdyXyG.js'></script>
    <script src="audioScript.js"></script>

    <!-- Help popup javascript -->
    <script>
      var newWin;
      // When the user clicks on '?' icon, open the help popup
      function createPopupWin(pageURL, pageTitle,
                    popupWinWidth, popupWinHeight) {
            var left = (screen.width - popupWinWidth) / 2;
            var top = (screen.height - popupWinHeight) / 4;
      
            var myWindow = window.open(pageURL, pageTitle,
                    'resizable=yes, width=' + popupWinWidth
                    + ', height=' + popupWinHeight + ', top='
                    + top + ', left=' + left);
        }

    </script>

    <!-- Video player javascript -->
    <script>
      // Handle video file input change event
      const videoFileInput = document.getElementById('video-file-input');

      videoFileInput.addEventListener('change', function () {
        const videoFiles = this.files;
        if (!videoFiles || !videoFiles[0]) {
            return;
        }

        const videoFileUrl = URL.createObjectURL(videoFiles[0]);

        // Load the video file
        var video = document.getElementById('video');
        video.src = videoFileUrl;
        video.play();
      });
    </script>
    
    <!-- 1D sliders javascript -->
    <script>
      //Handle multiple sliders input change event
      var rangeSlider = function() {
        var sliders = document.querySelectorAll('.range-slider');
        
        sliders.forEach(function(slider) {
            var range = slider.querySelector('.range-slider__range');
            var value = slider.querySelector('.range-slider__value');

            var values = slider.querySelectorAll('.range-slider__value');
            values.forEach(function(val) {
            var valValue = val.previousElementSibling.getAttribute('value');
            val.innerHTML = valValue;
            });

            range.addEventListener('input', function() {
            value.innerHTML = this.value;
            });
        });
      };

      rangeSlider();  
    </script>

    <!-- <script src="annotationScript.js"></script> -->
  </body>
</html>