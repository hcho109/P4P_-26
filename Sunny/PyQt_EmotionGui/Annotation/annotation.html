<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>EmotionalGUI Annotation WebPage</title>
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link 
      rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
      crossorigin="anonymous" referrerpolicy="no-referrer" 
    />
    <link href="annotationpg.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script src="https://unpkg.com/wavesurfer.js"></script>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <script src="script.js"></script>

  </head>

  <body>
    
    <!-- Top navigation -->
    <div class="nav">
      <a href="#home">Home</a>
      <a href="#visualize">Visualize</a>
      <a class="active" href="#annotation">Annotation</a>
      <a href="#live_audio">Live Audio</a>
      <a href="#about" class="help">Help</a>
    </div>

    <div class="title">
      Speech Emotion Annotation
    </div>

    <!--Left column-->
    <div class="split left">
      <div class="centered">
        <div class="subtitle">
          <h3>Video/Audio Multimedia</h3>
        </div>

        <!--Multimedia player tab links-->
        <div class="mediaPlayerTab">
          <button class="mediaTablinks" onclick="openPlayer(event, 'videoPlayer')" id="defaultPlayerOpen">Video Player</button>
          <button class="mediaTablinks" onclick="openPlayer(event, 'audioPlayer')">Audio Player</button>
        </div>

        <!-- Multimedia player tab content-->
        <div id="videoPlayer" class="mediaTabcontent">
          <!-- <input class="open-file-btn" type="button" id="multimediaFile_input" value="Open Video/Audio File"> -->
          <input class="open-file-btn" type="file" accept="video/*" id="video-file-input" value="Open Video File">

          <!--Video player-->
          <div class="video-wrapper">
            <h4>Video player</h4>

            <video class="video" id="video" controls>
              <source src="test1.mp4" type="video/mp4">
              <source src="test1.wmv" type="video/wmv">
              Your browser does not support the video tag.
            </video><br>
          </div>
        </div>

        <!--Audio Player-->
        <div id="audioPlayer" class="mediaTabcontent">
          <input class="open-file-btn" type="file" accept="audio/*" id="audio-file-input" value="Open Audio File">

          <h4>Audio player</h4>
        
          <div class="audio-container">
            <div class="track-name">The name of the audio file</div>

            <div class="audioWaveform" id="waveform"></div>
            <div class="buttons">
              <span class="play-btn btn">
                <i class="fa-solid fa-play"></i>
                <i class="fa-solid fa-pause"></i>
              </span>

              <span class="stop-btn btn">
                <i class="fa-solid fa-stop"></i>
              </span>

              <span class="mute-btn btn">
                <i class="fa-solid fa-volume-high"></i>
                <i class="fa-solid fa-volume-mute"></i>
              </span>

              <input type="range" min="0" max="1" step="0.1" value="0.5" class="volume-slider">
            </div>
          </div>
        </div>

        <!-- <div class="audio-wrapper">          
          <audio controls>
            <source src="horse.ogg" type="audio/ogg">
            <source src="test_annotation.wav" type="audio/wav">
            Your browser does not support the audio element.
          </audio><br><br>
        </div> -->

        <!-- Remove media player controller buttons
      <label for="multimedia_file"> Video/Audio Player Controller: </label>
      <input type="button" class=media_btn id="play_btn" value="Play from start">
      <input type="button" class=media_btn id="forward_btn" value="Forward">
      <input type="button" class=media_btn id="backward_btn" value="Backward">
      <input type="button" class=media_btn id="Vol_inc_btn" value="Increase Volume">
      <input type="button" class=media_btn id="Vol_dec_btn" value="Decrease Volume"><br><br>
      <label for="playback_speed">Playback Speed:</label>
      <input type="range" min="1" max="10" value="5" class="slider" id="speedRange">
      -->
      </div>
    </div>

    <!--Right Column-->
    <div class="split right">
      <div class="centered">
        <div class="subtitle">
          <h3>Valence-Arousal Plot</h3>
        </div>
      
        <div class="icon-bar">
          <!-- Remove home icon <a href="#"><i class="fa fa-home fa-2x"></i></a>-->
          <a href="#"><i class="fa fa-arrow-left fa-2x"></i></a>
          <a href="#"><i class="fa fa-arrow-right fa-2x"></i></a>
          <a href="#"><i class="fa fa-arrows fa-2x"></i></a>
          <a href="#"><i class="fa fa-search fa-2x"></i></a>
          <a href="#"><i class="fa fa-sliders fa-2x"></i></a>
          <a href="#"><i class="fa fa-line-chart fa-2x"></i></a>
          <a href="#"><i class="fa fa-floppy-o fa-2x"></i></a>
        </div>

        <img class="plot" src="Valence-Arousal_plot.png" alt = "valence-arousal plot graph img"><br><br>

        <form>
          <input type="button" class=annotation_btn id="clear_btn" value="Clear">
          <input type="button" class=annotation_btn id="CSV_btn" value="Save as CSV">
          <input type="button" class=annotation_btn id="Reannotate_btn" value="Re-annotate">
        </form><br>
      </div>
    </div>

    </body>

    <script>
      const waveformContainer = document.getElementById('waveform');
      const audioFileInput = document.getElementById('audio-file-input');
      const videoFileInput = document.getElementById('video-file-input');

      // Initialize WaveSurfer
      const wavesurfer = WaveSurfer.create({
          container: waveformContainer,
          waveColor: 'lightgray',
          progressColor: 'red',
          barWidth: 2
      });

      // Handle audio file input change event
      audioFileInput.addEventListener('change', function () {
          const audioFiles = this.files;
          if (!audioFiles || !audioFiles[0]) {
              return;
          }

          const audioFileUrl = URL.createObjectURL(audioFiles[0]);

          // Load the audio file

          wavesurfer.load(audioFileUrl);
      });

      // Handle video file input change event
      videoFileInput.addEventListener('change', function () {
        const videoFiles = this.files;
        if (!videoFiles || !videoFiles[0]) {
            return;
        }

        const videoFileUrl = URL.createObjectURL(videoFiles[0]);

        // Load the video file
        var video = document.getElementById('video');
        video.src = videoFileUrl;
        video.play();
      });

      function openPlayer(evt, mediaPlayerName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("mediaTabcontent");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("mediaTablinks");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(mediaPlayerName).style.display = "block";
        evt.currentTarget.className += " active";
      }
      
      // Get the element with id="defaultOpen" and click on it
      document.getElementById("defaultPlayerOpen").click();

    </script>


</html>