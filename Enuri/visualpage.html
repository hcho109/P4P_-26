<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>EmotionalGUI Annotation WebPage</title>
        <!-- Add icon library -->
        <link 
        rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" 
        />
        <link href="annotationStyle.css" rel="stylesheet" type="text/css" />
        <link href="mediaPlayerStyle.css" rel="stylesheet" type="text/css" />
        <link href="navStyle.css" rel="stylesheet" type="text/css" />
        <link href="visualpage.css" rel="stylesheet" type="text/css" /> <!-- css file for visual page-->
        <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-1.12.4.min.js"> </script>
        <!-- Py-Script header files-->
        <link rel="stylesheet" href="https://pyscript.net/releases/2023.05.1/pyscript.css" />
        <script defer src="https://pyscript.net/releases/2023.05.1/pyscript.js"></script>

        <!-- javascript csv files -->
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
        <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"></script>
        <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.js"></script>
        <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js"></script>
        <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.2.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/@holoviz/panel@0.13.0/dist/panel.min.js"></script>
        <script type="text/javascript">
          Bokeh.set_log_level("info");
        </script>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script> <!--for capturing the images of the plots-->



        <py-config>
            packages = ["numpy", 
                        "matplotlib", 
                        "pandas",
                        "keras"
                        ]
                        
            [[interpreters]]
            src = 'https://cdn.jsdelivr.net/pyodide/v0.23.3/full/pyodide.js'
            name = 'pyodide-0.23.3'
            lang = 'python'
        </py-config>

    </head>

    <body>
        
        <!-- Top navigation -->
        <header>   
        <div class="website_name">
            <img src="resources/University_of_Auckland_logo.png" width='60px' height='auto' alt = "UoA logo">
            <h3>EmotionGUI</h3>
        </div>
        <nav>
            <ul class="nav_links">
                <li><a href="home.html">Home</a></li>
                <li><a href="annotation.html">Annotation</a></li>
                <li><a class="active" href="visualise.html">Visualise</a></li>
                <li><a href="liveAudio.html">Live Audio</a></li>      
            </ul>
        </nav>
        <div class="dropdown">
            <button class="dropbtn">Help 
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <button onclick = "createPopupWin('#aboutEmotionGUI', 'EmotionGUI', 1000, 650);">EmotionGUI</button>
                <button onclick = "createPopupWin('about/aboutAnnotation.html', 'Annotation', 1000, 650);">Annotation</button>
                <button onclick = "createPopupWin('#aboutVisualise', 'Visualise', 1000, 650);">Visualise</button>
                <button onclick = "createPopupWin('#aboutLiveAudio', 'Live Audio', 1000, 650);">Live Audio</button>
            </div>
        </div> 
        </header>
        <!------------------ Left column ------------------------->
        <div class="split left">
            <div class="centered">
                <!--Files tab links-->
                <div class="fileTabs">
                    <!----------------  CSV File select tab------------------>
                    <input type="radio" id="tabCSVFile" name="fileTabs" checked="checked">
                    <label for="tabCSVFile">Plot CSV File</label>
            
                    <!-- CSV tab content-->
                    <div class="fileTabcontent">

                        <h3>Upload CSV file </h3>

                        <form id="form">
                            <input type="file" id="file" accept=".csv" />
                            <br />
                            <input id="submit_btn" type="submit" value="Upload" />
                        </form>
                        <button py-click="plot_csv()" id="csv_plot" class="py-button">Plot CSV </button>

                        <button id="saveButton" class="py-button" onclick="savePlotAsImage()">Save Plot</button>

                        <div id="container"> </div>

                    </div>
  
                    <!------------------ WAV File select tab---------------------->
                    <input type="radio" id="tabWAVFile" name="fileTabs">
                    <label for="tabWAVFile">Plot WAV File</label>
  
                    <!-- WAV tab content-->
                    <div class="fileTabcontent">
                        <input class="open-file-btn" id="fileinput" type="file" accept="audio*,video*"/>
                        <canvas class="canvas_audio" id="canvas_spectrogram"></canvas>
                        <canvas class="canvas_audio" id="canvas_waveform"></canvas>
                        <audio id="audio" src="" controls="true"></audio>
                        <p id="AudioPlayerStatus">Choose a 'WAV'/'MP3' audio file and Click 'Play' button to start playing</p>

                    </div>
                </div>
            </div>
        </div>


        <!------------------ Right column ------------------------->
        <div class="split right">
            <div class="centered">
                <div id="plot"> </div>
                <!-- <py-script output="plot">
                    import matplotlib.pyplot as plt
                    import numpy as np
                    import pandas as pd
                    from pyodide.ffi import create_proxy, to_js
                    from js import valence_arr, arousal_arr
                    import asyncio
                
                    # Declare fig and axes as global variables
                    global fig, axes
                    fig = None
                    axes = None
                    button_clicked = False

                    def initialize_plot():
                        global fig, axes
                        fig = plt.figure(figsize=(20, 18))
                        axes = fig.subplots()
                
                        plt.title("V-A Plot", fontsize=50)
                        plt.xlabel("Valence", fontsize=35)
                        plt.ylabel("Arousal", fontsize=35)
                
                        theta = np.linspace(0, 2 * np.pi, 100)
                        radius = 1
                
                        a = radius * np.cos(theta)
                        b = radius * np.sin(theta)
                
                        axes.plot(a, b, color='k', linewidth=1)
                        axes.set_aspect(1)
                
                        axes.hlines(y=0, xmin=-1, xmax=1, linewidth=0.7, color='k')
                        axes.vlines(x=0, ymin=-1, ymax=1, linewidth=0.7, color='k')
                
                        axes.tick_params(axis='both', which='major', labelsize=25)
                        axes.tick_params(axis='both', which='minor', labelsize=25)
                
                        landmarkEmotions = ['angry', 'afraid', 'sad', 'bored', 'excited',
                                            'interested', 'happy', 'pleased', 'relaxed', 'content']
                        landmarkValence = (-0.7, -0.65, -0.8, -0.1, 0.37,
                                            0.2, 0.5, 0.35, 0.6, 0.5)
                        landmarkArousal = (0.65, 0.5, -0.15, -0.45, 0.9,
                                            0.7, 0.5, 0.35, -0.3, -0.45)
                
                        for point in range(len(landmarkEmotions)):
                            axes.scatter(landmarkValence, landmarkArousal, color='black', s=40)
                            axes.text(landmarkValence[point] + 0.02, landmarkArousal[point] + 0.02,
                                        landmarkEmotions[point], fontsize=30)
                
                        axes.yaxis.grid(color='grey', linestyle='dashed', linewidth=0.3)
                        axes.xaxis.grid(color='grey', linestyle='dashed', linewidth=0.3)
                
                        display(fig, target="plot")
                
                
                    # Define a function to update the plot
                    def update_plot():
                        global fig, axes, valence_arr, arousal_arr
                        if button_clicked:
                            axes.clear()
                
                            # Update the plot with new data using valence_arr and arousal_arr
                            for point in range(len(valence_arr)):
                                axes.scatter(valence_arr[point], arousal_arr[point], color='red', s=60)
                
                            # ... Other plot customization ...
                
                            display(fig, target="plot")
                            fig.canvas.flush_events()
                
                    def plot_csv():
                        global button_clicked, fig, axes
                        button_clicked = True
                
                        if fig is not None:
                            plt.close(fig)
                
                        initialize_plot()
                    
                        # Update the plot with new data using valence_arr and arousal_arr
                        for point in range(len(valence_arr)):
                            axes.scatter(valence_arr[point], arousal_arr[point], color='red', s=60)
                    
                        # ... Other plot customization ...
                    
                        display(fig, target="plot")

                    # Initial plot creation
                    initialize_plot()
                </py-script> -->
                
                <py-script output="plot">
                    import matplotlib.pyplot as plt
                    import numpy as np
                    from pyodide.ffi import create_proxy, to_js
                    from js import valence_arr, arousal_arr
                
                    # Declare fig and axes as global variables
                    global fig, axes
                    fig = plt.figure(figsize=(20, 18))
                    axes = fig.subplots()
                    button_clicked = False
                
                    def initialize_plot():
                        global fig, axes
                        plt.title("V-A Plot", fontsize=50)
                        plt.xlabel("Valence", fontsize=35)
                        plt.ylabel("Arousal", fontsize=35)
                
                        theta = np.linspace(0, 2 * np.pi, 100)
                        radius = 1
                
                        a = radius * np.cos(theta)
                        b = radius * np.sin(theta)
                
                        axes.plot(a, b, color='k', linewidth=1)
                        axes.set_aspect(1)
                
                        axes.hlines(y=0, xmin=-1, xmax=1, linewidth=0.7, color='k')
                        axes.vlines(x=0, ymin=-1, ymax=1, linewidth=0.7, color='k')
                
                        axes.tick_params(axis='both', which='major', labelsize=25)
                        axes.tick_params(axis='both', which='minor', labelsize=25)
                
                        landmarkEmotions = ['angry', 'afraid', 'sad', 'bored', 'excited',
                                            'interested', 'happy', 'pleased', 'relaxed', 'content']
                        landmarkValence = (-0.7, -0.65, -0.8, -0.1, 0.37,
                                            0.2, 0.5, 0.35, 0.6, 0.5)
                        landmarkArousal = (0.65, 0.5, -0.15, -0.45, 0.9,
                                            0.7, 0.5, 0.35, -0.3, -0.45)
                
                        for point in range(len(landmarkEmotions)):
                            axes.scatter(landmarkValence, landmarkArousal, color='black', s=40)
                            axes.text(landmarkValence[point] + 0.02, landmarkArousal[point] + 0.02,
                                        landmarkEmotions[point], fontsize=30)
                
                        axes.yaxis.grid(color='grey', linestyle='dashed', linewidth=0.3)
                        axes.xaxis.grid(color='grey', linestyle='dashed', linewidth=0.3)
                
                        display(fig, target="plot")
                
                    def update_plot():
                        global fig, axes, valence_arr, arousal_arr
                        if button_clicked:
                            # axes.clear()
                
                            # Update the plot with new data using valence_arr and arousal_arr
                            for point in range(len(valence_arr)):
                                axes.scatter(valence_arr[point], arousal_arr[point], color='red', s=60)
                
                            # ... Other plot customization ...
                
                            display(fig, target="plot")
                            fig.canvas.flush_events()
                
                    def plot_csv():
                        global button_clicked
                        button_clicked = True
                        update_plot()
                
                    # Initial plot creation
                    initialize_plot()
                </py-script>
                
                <!-- ... (rest of the HTML code) ... -->
                

            </div>
        </div>
        
        <script src="annotation_js/mediaControls.js"></script>

        <!-- CSV javascript -->
        <script src="visualise_js/csv.js"></script>

        <!-- downloading the plots javascript -->
        <script src="visualise_js/image_utils.js"></script>


         <!-- Audio waveform javascript -->
        <script src="visualise_js/audio.js"></script>
        
    </body>
</html> 